<!DOCTYPE html>
<head>
<meta charset="utf-8">
<script src="https://d3js.org/d3.v4.min.js"></script>
<style>

body {
  margin:auto;  
  width: 885px;
  font: 10px arial;
  padding: 25px;
}
.y-axis line {
  opacity:.2;
}
.y-axis path {
  display:none;
}
.line {
  fill: none;
  stroke-width: 1.5px;
  opacity:.75;
}
.overlay {
  fill: none;
  pointer-events: all;
}
.lineHoverText {
  text-shadow:
  -2px -2px 0 #fff,
  2px -2px 0 #fff,
  -2px 2px 0 #fff,
  2px 2px 0 #fff;
}
.hoverCircle {
  opacity: .75;
}

</style>
</head>

<body>

<font style="font-size:11px;">Change State:</font>
<select id="selectbox">
  <option value="Alabama">Alabama</option>
  <option value="Alaska">Alaska</option>
</select>

<svg id="chart" width="800" height="600"></svg>

<script>  
  var margin = {top: 20, right: 20, bottom: 20, left: 50},
  width = 700 - margin.left - margin.right,
  height = 500 - margin.top - margin.bottom;  

  var yearly_people_count = {}
  yearly_people_count["2012"] = 2013.98
  yearly_people_count["2013"] = 2026.34
  yearly_people_count["2014"] = 601.41
  yearly_people_count["2015"] = 1990.24
  yearly_people_count["2016"] = 1854.87
  yearly_people_count["2017"] = 1859.14
  yearly_people_count["2018"] = 1800.84
  yearly_people_count["2019"] = 1801.01
  yearly_people_count["2020"] = 1579.59
  yearly_people_count["2021"] = 1635.43
  
  d3.csv("asec_groupededulevels.csv", function(error, data) {
    // d3.csv("company.csv", function(error, data) {
    if (error) throw error;
    // nest our data
    var data = data.filter(function(d) {
       return d.STATE == "Alabama"; 
    });

    var dataGroup = d3.nest()
    .key(function(d) {return d.EDU_LEVEL;})
    .key(function(d) {return d.YEAR;})
    .rollup (function(v) { return {
       EDU_LEVEL_COUNT: d3.sum(v, function(d) {return d.EDU_LEVEL_COUNT; })
     }; })
    .entries(data);
    

    var svg = d3.select("#chart")
    .append("svg")
      // .attr("width", width + margin.left + margin.right)
      // .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

    var xScale = d3.scaleLinear()
      .domain(d3.extent(data, function(d) { return d.YEAR; }))
      .range([ 0, width ]);
    svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(xScale).ticks(10).tickFormat(d3.format("Y")));

    // Add Y axis
    var yScale = d3.scaleLinear()
      // .domain([0, d3.max(data, function(d) { return +d.EDU_LEVEL_COUNT; })])
      // .domain([0, 10*d3.max(data, function(d) { return +d.EDU_LEVEL_COUNT; })])
      .domain([0, 30])
      .range([ height, 0 ])

    svg.append("g")
      .call(d3.axisLeft(yScale)
        .ticks(5)
        .tickSizeInner(0)
        .tickPadding(6)
        .tickSize(0, 0)
      )

    



    var lineGen = d3.line()
      .x(function(d) {
          return xScale(d.YEAR);
      })
      .y(function(d) {
          return yScale(d.EDU_LEVEL_COUNT);
      })




    var res = dataGroup.map(function(d){ return d.key }) // list of group names
    var color = d3.scaleOrdinal()
      .domain(res)
      .range(["#b87a9c",
        "#38af28",
        "#b22bb2",
        "#3ce09b",
        "#a968f3",
        "#fdba37",
        "#014fbb",
        "#be5100",
        "#7e8aff",
        "#d62426",
        "#10c3ff",
        "#de0064",
        "#016e3e",
        "#ff64ce",
        "#585509",
        "#464a99",
        "#f8ba78",
        "#8f2c61",
        "#814118",
        "#ff9f9b"])

    svg.selectAll(".line")
      .data(dataGroup)
      .enter()
      .append("path")
        .attr("fill", "none")
        .attr("stroke", function(d){ return color(d.key) })
        .attr("stroke-width", 1.5)
        .attr("stroke-opacity", 0.5)
        .attr("d", function(d){
          return d3.line()
            .x(function(d) { return xScale(d.key); })
            .y(function(d) { return yScale(+d.value.EDU_LEVEL_COUNT / yearly_people_count[d.key]); })
            (d.values)
        })

    // Add one dot in the legend for each name.
    var size = 5
    svg.selectAll("mydots")
      .data(res)
      .enter()
      .append("rect")
        .attr("x", 500)
        .attr("y", function(d,i){ return 20 + i*(size+5)}) // 100 is where the first dot appears. 25 is the distance between dots
        .attr("width", size)
        .attr("height", size)
        .style("fill", function(d){ return color(d)})


    // Add one dot in the legend for each name.
    svg.selectAll("mylabels")
      .data(res)
      .enter()
      .append("text")
        .attr("x", 500 + size*1.2)
        .attr("y", function(d,i){ return 20 + i*(size+5) + (size/2)}) // 100 is where the first dot appears. 25 is the distance between dots
        .style("fill", function(d){ return color(d)})
        .text(function(d){ return d})
        .attr("text-anchor", "left")
        .style("alignment-baseline", "middle")


  });
  

</script>
</body>